/*
 * generated by Xtext 2.16.0
 */
package com.mimacom.ddd.dm.dem.validation

import com.mimacom.ddd.dm.base.BasePackage
import com.mimacom.ddd.dm.base.DNamedElement
import com.mimacom.ddd.dm.dem.DActor
import com.mimacom.ddd.dm.dem.DCaseConjunction
import com.mimacom.ddd.dm.dem.DDomainEvent
import com.mimacom.ddd.dm.dem.DNotification
import org.eclipse.xtext.validation.Check

/**
 * This class contains custom validation rules. 
 *
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#validation
 */
class DemValidator extends AbstractDemValidator {
	
	static val BASE = BasePackage.eINSTANCE
	
	@Check
	def checkOtherwiseClause(DDomainEvent event) {
		val caseConjunctions =  event.postconditionsDNF.filter(DCaseConjunction)
		val countOtherwise = caseConjunctions.filter[otherwise].size
		if (countOtherwise == 1) {
			for(var i=0; i<caseConjunctions.size; i++) {
				if (caseConjunctions.get(i).otherwise && i !=caseConjunctions.size-1) {
					error ("The 'otherwise' clause must be last", caseConjunctions.get(i), BASE.DNamedElement_Name)
				}
			}
		} else if (countOtherwise > 1) {
			for(var i=0; i<caseConjunctions.size; i++) {
				if (caseConjunctions.get(i).otherwise) {
					error ("There can only be one 'otherwise' clause ", caseConjunctions.get(i), BASE.DNamedElement_Name)
				}
			}
		}
	}
	

	@Check
	def void checkTypeNameStartsWithCapital(DActor a) {
		checkNameStartsWithCapital(a)
	}

	@Check
	def void checkTypeNameStartsWithCapital(DDomainEvent de) {
		checkNameStartsWithCapital(de)
	}

	@Check
	def void checkTypeNameStartsWithCapital(DNotification n) {
		checkNameStartsWithCapital(n)
	}
	

	def void checkNameStartsWithCapital(DNamedElement ne) {
		checkNameStartsWithCapitalImpl(ne.name, ne)
	}
	

	// // Naming: Elements whose names should start with a CAPITAL
	protected def void checkNameStartsWithCapitalImpl(String name, DNamedElement ne) {
		if (name !== null && name.length > 0 && !Character::isUpperCase(name.charAt(0))) {
			warning("Name should start with a capital", ne, BasePackage.Literals::DNAMED_ELEMENT__NAME)

		}
	}
}
